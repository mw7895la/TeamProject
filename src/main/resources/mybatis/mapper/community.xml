<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.community">

	<!-- Community 글 올리기 -->
   <insert id="communityInsert" parameterType="community">
      insert into community(c_mnickname,c_content,c_title,c_image,c_number,c_date)
      values(#{c_mnickname},#{c_content},#{c_title},#{c_image},SEQ_C_NUMBER.nextval,sysdate)
   </insert>
   
   <!-- Community 댓글 올리기  -->
   <insert id="communityReplyInsert" parameterType="community">
      insert into c_reply(cr_rmnickname, cr_cnumber, cr_rdate, cr_rcontent, cr_rnumber)
      values(#{cr_rmnickname}, #{cr_cnumber}, sysdate, #{cr_rcontent}, SEQ_COM_REPLY.nextval)
   </insert>
   
   <!-- Community Detail로 넘어가기  -->
   <select id="communityselectOne" resultType="community" parameterType="community">
      select c_mnickname, c_content, c_title, c_number, c_date, c_image, mimage, memail
      from community, member
      where c_number = #{c_number} and member.mnickname=#{c_mnickname}
   </select>
   
   <!-- Community 댓글 List -->
   <select id="communityReplyList" parameterType="int" resultType="community">
   		select cr_rcontent, mimage, cr_rmnickname, memail
		from c_reply cr, community c, member m
		where cr.cr_cnumber = #{c_number} and cr.cr_cnumber = c.c_number and cr.cr_rmnickname = m.mnickname;
   </select> 
   
   <!-- Community 댓글 Count -->
    <select id="communityreplyCount" parameterType="community" resultType="int">
		select count(*) from c_reply c where c.cr_cnumber = #{c_number}
	</select>
   
   <!-- 댓글 페이지 별로 분리하기 -->
    <select id="communityReplyByPage" parameterType="community" resultType="community">
   		select rnum, cr_rmnickname, cr_cnumber, cr_rcontent,  rmimage, rmemail
		from(
		select rownum as rnum, cr_cnumber, cr_rcontent,  rmimage, cr_rmnickname, rmemail
		from (
		select cr_cnumber, cr_rcontent,  rmimage, cr_rmnickname, rmemail
		from c_reply r, member m, community c
		where r.cr_rmnickname = m.mnickname and r.cr_cnumber = #{c_number}
		order by cr_cnumber desc
		)
		where rownum &lt;= #{endRowNo}
		)
		where rnum &gt;= #{startRowNo}  
   </select>
   
   <!-- Community List 페이지로 보게 하기 -->
   <select id="communityselctAll" resultType="community" parameterType="pager">
      select *
      from(
         select rownum as rnum, c_number, c_title, c_date, c_content, C_MNICKNAME, C_IMAGE,C_COUNT
         from(
               select * from community
               order by c_date desc
         )
         where rownum &lt;= #{endRowNo}
      )
      where rnum &gt;= #{startRowNo}
   </select>
   
   
   <!-- Community Search로 검색해서 보게 하기 -->
   <select id="communityselctSerch" resultType="community" parameterType="pager">
      select*
      from(
      select rownum as rnum, c_number, c_title, c_date, c_content, C_MNICKNAME, C_IMAGE,C_COUNT from (select * from community where c_content like #{temp} or c_title like #{temp} order by c_date desc)
      where rownum &lt;= #{endRowNo}
      )
      where rnum &gt;= #{startRowNo}
   </select>
   
   <!-- Community 조회수   -->
   <update id="communityUpdatehits" parameterType="int">
   		update community set c_count = c_count + 1 where c_number=#{cnumber}
   </update>
   
   <!-- Community 조회수   -->
   <select id="communityHitsselctAll" resultType="community">   
  		 SELECT *FROM 
    	(SELECT * FROM community ORDER BY c_count DESC) WHERE ROWNUM &lt;= 5
   </select>
   
   <!-- Community 조회수 Count -->
   <select id="communityselectAllcount" resultType="int">
   		select count(*) from community      
   </select>
   
   <!-- Community 조회수 search Count -->
   <select id="communityselectAllSearchcount" resultType="int" parameterType="String">
   		select count(*) from community where c_content like #{temp} or c_title like #{temp}
   </select>


</mapper>
